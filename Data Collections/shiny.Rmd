---
title: "shinyapp_tariff"
output: html_document
author: "Federico Chung"
---

INPUTS:
country
sector(industry)
-ALL (CATEGORY NEEDED)
product
-ALL (CATEGORY NEEDED)


time

OUTPUT:
Tariff
Exports
Sentiment

```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library(stringr)
library(shiny)
library(shinydashboard)
library(readr)
library(DT)
library(scales)
library(lubridate)
```

```{r}
CH_tariff<-read.csv("export_tariff_final.csv")
exports<-read.csv("exports.csv")
names<- read.csv("names.csv")

names<-names%>%
  mutate(hs4= ifelse(nchar(hs4)==3,paste("0",hs4,sep="") ,hs4))%>%
  select(hs4, TIER.1.DESCRIPTION)


```


```{r}
CH_tariff<-
  US_tariff%>%
  mutate(Date = as.Date(Date))

Exports<-
  exports%>%
  mutate(Date= as.Date(Date))

Exports<-
  Exports%>%
  select(hs6, value,Date)

Total<-
  Exports%>%
  group_by(Date)%>%
  summarise(value= sum(value))%>%
  mutate(hs6 = "all")%>%
  mutate(hs4 = "all")%>%
  mutate(TIER.1.DESCRIPTION = "all")
Exports
Total<-Total%>%
  select(hs6,value,Date,hs4,TIER.1.DESCRIPTION)



Exports<-Exports%>%
  mutate(hs4 = substr(hs6,start=1,stop=4))


Exports<-Exports%>%
  left_join(names)

Total

exports<-rbind(Exports, Total)
```



```{r}
#data --> includes all*
exports

#Define a plotting function

plot_exports<- function(product){
  export_data<-
    exports%>%
    filter(TIER.1.DESCRIPTION == product)%>%
    group_by(Date)%>%
    mutate(value = sum(value))
  ggplot(export_data, aes(x = Date, value))+
    geom_smooth(method = "loess")+
    geom_point()+
    labs(title = paste("Exports of ",product))
}

# Build the shiny server
server <- function(input, output) {
  output$plot <- renderPlot({
    plot_exports(product = input$product)
  })
}

# Build the shiny user interface
ui <- fluidPage(
  radioButtons(
    inputId = "product",
    label = "product",
    choices = unique(exports$TIER.1.DESCRIPTION)
    
    
  ),
  mainPanel(
    h4("Plot:"),
    plotOutput("plot")
  )
)






# Run the shiny app!
shinyApp(ui = ui, server = server)
```
```{r}
exports

exports%>%
  filter(TIER.1.DESCRIPTION == "Live animals; animal products")%>%
  group_by(Date)%>%
  mutate(value = sum(value))%>%
  ggplot(aes(x = Date, y = value))+
  geom_point()+
  geom_line()



```












